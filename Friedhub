-- Football Fusion 2 - Undetectable Magnet + Full Features
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local settingsKey = "FF2_Settings"
local settings = {
    magnet = true,
    autoCatch = true,
    freezeTech = false,
    freezeTime = 2,
    esp = true,
    path = true,
    range = 45, -- Max 80
    angleEnhancer = true
}

pcall(function()
    if readfile then
        local stored = HttpService:JSONDecode(readfile(settingsKey))
        for k,v in pairs(stored) do settings[k] = v end
    end
end)

local function saveSettings()
    pcall(function()
        if writefile then
            writefile(settingsKey, HttpService:JSONEncode(settings))
        end
    end)
end

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "FF2_GUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 280, 0, 420)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(42, 75, 160)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = gui

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "FF2 Legit Mode"
title.TextColor3 = Color3.new(1,1,1)
title.Font = Enum.Font.GothamBold
title.TextSize = 18

local yOffset = 35
local function createToggle(name, default, callback)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(1, -10, 0, 30)
    btn.Position = UDim2.new(0, 5, 0, yOffset)
    btn.Text = name .. ": " .. (default and "ON" or "OFF")
    btn.BackgroundColor3 = Color3.fromRGB(30,30,30)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.MouseButton1Click:Connect(function()
        default = not default
        btn.Text = name .. ": " .. (default and "ON" or "OFF")
        callback(default)
        saveSettings()
    end)
    yOffset += 35
end

local function createSliderBox(name, val, min, max, callback)
    local box = Instance.new("TextBox", frame)
    box.Position = UDim2.new(0, 5, 0, yOffset)
    box.Size = UDim2.new(1, -10, 0, 30)
    box.Text = name .. ": " .. val
    box.BackgroundColor3 = Color3.fromRGB(40,40,40)
    box.TextColor3 = Color3.new(1,1,1)
    box.ClearTextOnFocus = true
    box.Font = Enum.Font.Gotham
    box.TextSize = 14
    box.FocusLost:Connect(function(enter)
        if enter then
            local v = tonumber(box.Text:match("%d+"))
            if v then
                v = math.clamp(v, min, max)
                box.Text = name .. ": " .. v
                callback(v)
                saveSettings()
            else
                box.Text = name .. ": " .. val
            end
        end
    end)
    yOffset += 35
end

-- Create toggles/sliders
createToggle("Magnet", settings.magnet, function(v) settings.magnet = v end)
createToggle("Auto Catch", settings.autoCatch, function(v) settings.autoCatch = v end)
createToggle("Freeze Tech", settings.freezeTech, function(v) settings.freezeTech = v end)
createToggle("Ball ESP", settings.esp, function(v) settings.esp = v end)
createToggle("Ball Path", settings.path, function(v) settings.path = v end)
createToggle("Angle Enhancer", settings.angleEnhancer, function(v) settings.angleEnhancer = v end)
createSliderBox("Magnet Range", settings.range, 5, 80, function(v) settings.range = v end)
createSliderBox("Freeze Time", settings.freezeTime, 1, 5, function(v) settings.freezeTime = v end)

-- Key toggle
local guiVisible = true
UserInputService.InputBegan:Connect(function(i,gp)
    if not gp and i.KeyCode == Enum.KeyCode.B then
        guiVisible = not guiVisible
        frame.Visible = guiVisible
    end
end)

-- Safe Magnet + Catch Logic
task.spawn(function()
    local lastCatch = 0
    local catchCooldown = 0.15

    while true do
        task.wait()

        local ball = workspace:FindFirstChild("Football")
        local char = player.Character
        if not (settings.magnet or settings.autoCatch) or not ball or not char then continue end

        local hrp = char:FindFirstChild("HumanoidRootPart")
        local now = tick()

        if hrp and (now - lastCatch) >= catchCooldown then
            local predicted = ball.Position + (ball.AssemblyLinearVelocity * 0.15)
            local dist = (predicted - hrp.Position).Magnitude
            local isFacing = true

            if settings.angleEnhancer then
                local dir = (ball.Position - hrp.Position).Unit
                isFacing = hrp.CFrame.LookVector:Dot(dir) > 0.5
            end

            if isFacing and dist <= settings.range and settings.magnet then
                local bv = ball:FindFirstChild("MagPull") or Instance.new("BodyVelocity", ball)
                bv.Name = "MagPull"
                bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                bv.Velocity = (hrp.Position - ball.Position).Unit * 55
                game.Debris:AddItem(bv, 0.2)
                lastCatch = now

                if settings.freezeTech then
                    hrp.Anchored = true
                    task.delay(settings.freezeTime, function()
                        if hrp and hrp.Parent then hrp.Anchored = false end
                    end)
                end
            end
        end
    end
end)

-- ESP
RunService.RenderStepped:Connect(function()
    if settings.esp then
        local ball = workspace:FindFirstChild("Football")
        if ball and not ball:FindFirstChild("Highlight") then
            local h = Instance.new("Highlight", ball)
            h.FillColor = Color3.fromRGB(255,255,0)
            h.OutlineColor = Color3.fromRGB(255,0,0)
            h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        end
    end
end)

-- Ball Path Line
local ballPath
RunService.RenderStepped:Connect(function()
    if not settings.path then
        if ballPath then ballPath.Transparency = 1 end
        return
    end
    local ball = workspace:FindFirstChild("Football")
    local char = player.Character
    if not (ball and char and char:FindFirstChild("HumanoidRootPart")) then return end

    if not ballPath then
        ballPath = Instance.new("Part", workspace)
        ballPath.Anchored = true
        ballPath.CanCollide = false
        ballPath.Transparency = 0.4
        ballPath.Material = Enum.Material.Neon
        ballPath.Color = Color3.fromRGB(0, 255, 255)
        ballPath.Name = "BallPathLine"
    end

    local startPos = ball.Position
    local endPos = char.HumanoidRootPart.Position
    local dist = (endPos - startPos).Magnitude
    ballPath.Size = Vector3.new(0.2, 0.2, dist)
    ballPath.CFrame = CFrame.new(startPos, endPos) * CFrame.new(0, 0, -dist/2)
    ballPath.Transparency = 0
end)

frame.Visible = true
print("FF2 Undetectable Magnet Script Loaded âœ…")
